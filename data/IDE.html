<HTML>
<HEAD>
<TITLE>H/Z-100 IDE Controller</TITLE>
</HEAD>
<BODY BACKGROUND="../images/tile_sidebar.jpg">
<!-- VLINK="#ff00ff" LINK="#4000ff" ALINK="#4000ff" TEXT="#000000" -->
<BASEFONT FACE="Verdana, Arial" SIZE="2">

<table border=0 cellpadding=20 cellspacing=0 width=100% align=left>
<!-- This table is entire document! -->
<tr><td>
<TABLE CELLPADDING="0" CELLSPACING="0" BORDER=0 WIDTH=100%>
<!-- This table is just the first pix & Title. -->
<TR><TD ALIGN="center" VALIGN="middle">
<A HREF="../images/IDEctrlr02.jpg" target="_blank">
<IMG SRC="../images/IDEctrlr02.jpg" BORDER="0" width=400></A>
</TD><TD ALIGN="center"><FONT FACE="Verdana, Arial" SIZE=5>
<B><I>Z-100 LifeLine</I><BR>
IDE Controller Card</B><P>
</FONT></TD></TR>
</TABLE>

<tr><td ALIGN="center">
<img src="../images/bar.jpg" alt="--Divider--">
</td></tr>

<tr><td align="center" valign="middle">
<table border=0 cellpadding=10 cellspacing=0 width=90%>
<!-- This table contains ALL the graphics and text blocks. -->

<TR><TD ALIGN=left COLSPAN=2><FONT size=3>
<CENTER><B>*** ANNOUNCING ***</B></CENTER><BR></FONT>
<FONT size=2>While testing still continues, the new <I>Z-100 LifeLine</I> <B>IDE Controller Cards</B> have been assembled and shipped. It appears to work well with nearly everything we can throw at it, including the new Compact Flash (CF) memory cards and Disk-on-Module (DOM) memory units. There are a few extra boards available. Contact me NOW!<P>
And don't miss the article on the first operational IDE Controller in the Z-100 at <A HREF="Z100IDE.html">Z100IDE</A>.<P>
&nbsp;<P>

<CENTER><FONT FACE="Verdana, Arial" size=3><B><I>Z-100 LifeLine</I> IDE Controller Board</B></FONT></CENTER><P>
<TABLE border=0 cellpadding=0 cellspacing=0 width=100%>
<TR><TD colspan=2><FONT size=2><B>FEATURES:</B><P></TD></TR>

<TR><TD width=50><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Two IDE drive connectors which can each have a master and a slave<P></TD>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Compact Flash memory cards or Disk On Module(DOM) plug-in memory devices<BR>
can replace any or all of the IDE hard drives</TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;
+ These are prepared in the same manner as their hard drive cousins.<P></TD></TR>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>A 512Kb non-volatile sRAM chip provides:</TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;
+ <B>FAST</B> boot code</TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;
+ Room for other programs for <B>FAST</B> access<P></TD></TR>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>A Real Time Clock recognized by Z-DOS is on the NVsRAM chip<P></TD></TR>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Two NVsRAM LED's and four IDE Drive LED's to show drive activity<P></TD></TR>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Hardware Breakout Switch<P></TD></TR>

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Gold-plated S-100 bus connector fingers<P></TD></TR>
</FONT></TABLE>&nbsp;<P>

<TABLE border=0 cellpadding=0 cellspacing=0 width=100%>
<TR><TD colspan=2><FONT size=2><B>SYSTEM REQUIREMENTS:<P></B></FONT></TD></TR>

<TR><TD width=50><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>The IDE Controller requires a Heath/Zenith H/Z-100 series computer with:<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;+ A minimum of 192Kb motherboard RAM<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;+ A Z-ROM v4.3 monitor ROM<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;+ Z-DOS v4.06 Operating System<P></TD></TR> 

<TR><TD><img src="../images/bullet.jpg" hspace="0" vspace="0" alt="*" align="middle"></TD>
<TD><FONT size=2>Some <B>limitations</B> are also imposed on the IDE hard drives:<P></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;
+ Drives can retain any PC Operating System, which could still use a 16-bit FAT<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(e.g., Windows 9x) or 32-bit FAT (e.g., Windows 98SE).<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;
+ Each Z-100 accessible partition will be limited to 2 GBs in size<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(imposed by the maximum 16-bit FAT that would be usable by the Z-100)<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;
+ Maximum drive size that could be used with the Z-100 will be 137 GBs, as limited by<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
the 28-bit LBA addressing standards before ATA/ATAPI-6.<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;
+ We have found that some software (e.g., Peachtext 5000) do NOT recognize partitions<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
having sizes greater than 32Mb. We recommend creating one or two 30Mb<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
partitions on each drive for use with this software.<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;
+ The IDE drives will ONLY be recognized by Z-DOS v4.06. No previous versions of DOS,<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
nor other operating systems, will recognize the IDE drives.<BR></TD></TR>
<TR><TD></TD><TD><FONT size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
We hope to modify other operating systems to use the IDE drives in the future.<BR></TD></TR>
</FONT></TABLE>&nbsp;<P>

<FONT size=2><B>NOTE:</B>
<FONT size=1> Newer drives, larger than 137 GBs, are already on the market that meet the new 48-bit LBA addressing standard of ATA/ATAPI-6.<BR>
Presently, it does not appear that these will be supported by the Z-100. This isn't presently considered a problem because at 2 GB each,<BR>
what's a person already going to do with 67 partitions?<P>
</FONT>

<B>The <I>Z-100 LifeLine</I> Design Team:</B><P>

* Charles Hett is Hardware Guru<BR>
* John Beyers is Software Guru<BR>
* Steve Vagts is <I>Z-100 LifeLine</I> Editor and Project GoFer<P>

<B>Project Conception:</B><P>

The LLIDEHD driver is key to the success of PC/Z-100 interchangeability, enabling us to retain the use of our IDE hard drive in a PC and as a means for transferring data between the PC world and our Z-100's. This can be accomplished by simply placing the information on the drive in a format recognized by both systems. Further, since we have complete control over all aspects of doing this from a Z-100's perspective, it is possible to leave a primary partition on the IDE drive that would contain the PC's Operating System (Windows) that would be completely undisturbed by operation in the Z-100. In short, this means that we could use a properly prepared system drive from a PC, place it in the Z-100 to work on or transfer data files, then return with the information for processing on the PC. In broad terms, this involves assigning one or more partitions on the IDE drive for use on the Z-100.<P>

As presently conceived, there will be three ways of preparing an IDE hard drive for use in the Z-100. The first, easiest, and preferred method is to use the PC in which the drive may be used. We say this because there are so many different PC's and operating systems. The only way to ensure troublefree operation in a PC is to prepare the drive in that machine.<P>

For those less interested in PC interchangeability, there will eventually be two methods of preparing the IDE drive once installed in the Z-100. One would use a Z-100 version of FDISK. The other would be a quick and dirty format similar to that done on a floppy drive. This last version would not provide any means of compatibility with a PC. Both programs are on hold, waiting for someone with the necessary expertise and time to work on them. In the meantime, we will stay with the PC procedures.<P>

Procedures for programming the IDE devices is provided at
<A HREF="IDEprep.html">IDE PREP</A>.<P>

Procedures for programming the NVsRAM is provided at
<A HREF="NVsRAM.html">NVsRAM</A>.<P>

And don't miss the article on the first operational IDE Controller in the Z-100 at <A HREF="Z100IDE.html">Z100IDE</A>.<P>
&nbsp;<P>


<FONT size="3"><B>Project Status, as of January 2010:</B></FONT><P>

The IDE Controller boards have all been assembled. The new v4.3 monitor ROMs and the Z-DOS v4.06 CD-ROMs have been burned. All pre-orders have been filled and shipped. While everything we have been throwing at the new boards, including the new Compact Flash (CF) memory cards and Disk-on-Module (DOM) memory units, have been working, we have found that the DOM units require that U9 and U12 be changed to 74HCT245 chips. This is being investigated further.<P>

Several problems have already been recognized and still need to be addressed:<P>

* <B>Software Not Recognizing IDE Partitions</B> - Without going too deep into details, we have found that PeachText 5000, and probably other early software, do not know how to deal with partitions larger than 32 Mbs in size, probably due to memory addressing limitations. When we created some smaller partitions on our IDE drives, they were recognized and used by Peachtext 5000 just fine. The easiest workaround is to ensure that there is at least one 32 Mb partition on the new IDE drives for use by those applications that won't recognize anything larger.<P>

* With all the new drive partitions being placed on the IDE devices, and acerbated by the requirement to have one or more smaller (<32Mb) partitions, it has become very evident that a Partition Listing utility is required to perform the same function that ZDIR does to directories and files.<P>

* It appears that the Editor in Peachtext 5000 has scrolling problems with the latest Z-ROM chip. This requires confirmation and troubleshooting.<P>

* The Heath/Zenith Disk-based Diagnostics Program, DIAG, is giving false errors when running the system memory tests from an IDE device, including the NVsRAM. The symptoms vary, but may include freezing the computer, giving 'Wild Interrupts' or 'Divide by Zero' errors, scrambling info on the screen, false error reports, inconsistent operation, and other unexplained symptoms. After days of tracking this problem down, we think that it appears whenever SHARE.EXE is loaded. SHARE is required for using disk partitions greater than 32Mb in size. Until this is figured out, always run DIAG from a floppy drive and do NOT load SHARE.<P>

* There appears to be a problem with some PC clones not recognizing Compact Flash (CF) cards when placed on the same IDE connector as other drives. This requires further testing on both the PC and Z-100 machines.<P>

* <B>CAUTION:</B> Do NOT use WINDOWS to prepare and program your new IDE drives. While very tempting to just copy files and directories at the touch of a mouse, Windows places file volume names on all media during file transfers. These are seen on the Z-100 as additional volume labels and are NOT erasable at the present time. While they apparently cause no harm, they are listed with all the other file names and litter the start of the directory. Use a DOS startup disk and the DOS XCOPY utility to do your file transfers. The Z-DOS version of XCOPY works just great.<P>

* <B><I>WARNING:</I></B> Do NOT place a Z-100 bootable floppy disk in a PC for file transfers. The PC Windows system now writes a unique 8 byte disk ID to the boot loader on sector 0 of floppy disks, trashing any previous information! For more information read the article "<I>DANGER! - Understanding Disk Volume Tracking in Windows</I>" in issue #84 of the "<I>Z-100 LifeLine</I>".<P>

* John Beyers is no longer available. So work on software issues has slowed to a crawl. I'm looking for others with experience in assembly language to assist me in deciphering much of John's work so that we may continue to develop the remaining software to make maximum use of our new capabilities.<P>

* We are presently relying on the PC's Free FDISK to prepare the IDE drives on a PC. It is unknown when we will get to work on the FDISK and PCFORMAT programs to prepare the IDE drives while installed on the Z-100 computer. The next section discusses the FDISK problems in detail.<P>


<B>FDISK Problem</B><P>

While troubleshooting the Peathtext 5000 problem mentioned above, I tried a 64Mb Compact Flash 'CF' Card on a PC. I made two 32Mb partitions on it to try with PT5000 and ran SCANDISK on each partition - yet, every time I booted with it in the Z-100, the second partition was always listed as NO NAME. Nevertheless, COPY and FC (File Compare) operations were all successful, or so I thought. I also tried two Caviar 1210 drives with similarily sized partitions with the same results. The COPY and FC operations were also fine.<P>

Again without going into details, it seems that:<P>

* While all partitions and partition sizes are being recognized, their assigned labels are not. The bootup screen shows the first partition name correctly, but the rest are all reported as "NO NAME".<P>

* Large partitions (those >32mb) are working great, even if listed as "NO NAME". ZDIR recognizes the directory and new files are added correctly to the FAT.<P>

* Small partitions (those <32mb) are not working at all. ZDIR shows the directory as garbage or no files listed at all. New files are copied to the FAT correctly and File Compares are fine. However, once the drive is returned to a PC, the newly added files are NOT listed in the FAT. SCANDISK reports a difference in the two FATs and, feeling that FAT1 is correct, wants to replace FAT2 with FAT1. This results in the new files added by the Z-100 as being lost and is reported by SCANDISK as lost data! Further, a 512Kb file (my EPTEST.x file) is reported as 2Mb of lost data!<P>

<B>Free FDISK and Bug</B></P>

<B>Note:</B> This version of FDISK.EXE is from FreeDos version 1.2.1. John Beyers has reported that it has been run successfully on the Z100 with MFM hard drives, but to run on the Z-100, it needs ZPC installed and you must be in PC Mode. The .INI files must be placed in the same directory as FDISK.EXE. Free FDISK is available from:<P>

<U>http://www.23cc.com/free-fdisk/</U><P>

Charles Hett, who liked using Free FDISK instead of the Windows FDISK that I was using, was having different symptoms. His disks were all working properly, but showed size discrepancies on the boot screen.<P>

Later, when Charles tried using a Windows 98 version of FDISK, he had problems partitioning a Samsung 1.5Gb drive into two 32Mb partitions and one 1.44Gb partition. While FDisk seemed to work fine preparing the drive, and the partitions checked ok with CHKDISK and Norton Disk Dr, when the drive was placed on the Z-100, the partitions were recognized but were reported as using an unrecognized format that could not be read from or written to. He then repeated the entire process using Free FDisk and everything worked fine.<P>

Well, when I tried using Free FDISK, I've found that Charles was correct - that drives partitioned with Free FDISK work correctly, with one exception that I've found so far. Version 1.2.1 that Charles sent me seems to have a bug in judging the size of the last partition. If I create the last partition by using either the default - when the program asks if I wish to use all remaining space and making it the active partition - or if I answer NO and set the amount of memory myself using the amount the program says is left, it seems to be 1Mb too large and causes a problem.<P>

For example, using the amount of memory for each partition that I had been using with WIN98's FDISK, there should be 28Mb remaining on the Caviar 1210 drive that I had been using. The Free FDISK program reports that there is 29Mb left, but if I use the default and answer YES to the question, the memory changes to 28Mb when it is accepted anyway. And, if I place the 29Mb in myself, the program will still replace the 29 with 28Mb.<P>

But, it doesn't stop there either. With the 28Mb size for this last partition - whether automatic or if I place the 28Mb there myself, SCANDISK has a problem with this last partition. Every time I create the last partition and then FORMAT (ok), and copy files to it (ok), when I run SCANDISK on that last partition, it reports:<P>
  
<I>"SCANDISK cannot read from the last cluster on Drive x. This cluster is either damaged, or your system is not configured properly. Drive x may need to have Logical Block Addressing (LBA) enabled to work properly, or its disk partition may be incorrectly marked as a non-LBA partition. Data loss can occur if your LBA setting or disk partition type for this drive is misconfigured."</I><P>

In actuality, when SCANDISK does the surface scan, it starts calling ALL of the last 100 or so clusters as bad. As each cluster is examined, it takes about 3 minutes, so after an hour of examining each of these and declaring it bad, I quit only about half way through. Instead, I had to go back into FDISK and make that last partition 1Mb smaller and then everything was fine.<P>

Note: On the 512Mb CF card, for some reason, I had to drop 3Mbs because the Free FDISK program would not accept anything less.<P>

On the off chance that Win98 FDISK was having difficulty with the size of this last partition and causing my problems, I repartitioned the drive again with Win98 FDISK and reduced the last partition by 1Mb, but there was no change in the symptoms listed above.<P>

By the way, I also ran the Win95 version of FDISK on the Caviar 1210 drive before going to Free FDISK. It gave ALL the same symptoms as those partitions created with Win98 FDISK, EXCEPT that when using ZDIR, there were no garbage lines in the directory. It would just say that there were NO FILES! So when I copied EPTEST.DAT, that file would be the first one listed! Of course, when the drive was placed back in the PC, all the other files would be listed again, less the new one!<P>

End result: With the last partition sizes corrected, I've had NO problems using Free FDISK, as Charles has suggested. I've only completed testing with the two Caviar drives and one CF card so far, and I'll continue with the other drives I've got. If we cannot locate the reason for the Win9x FDISK problems (cluster size or other difficulty) we'll have to use the Free FDISK version to ensure compatibility.<P>

As a result of our testing, Charles and I felt confident that the IDE Controller Card is now functioning as it should. None of this sounded like a hardware issue with the new boards, but rather, because of the differences of Free FDisk and Win9x FDisk, which should be treating the Format sessions the same, we felt it must be a software issue. There is also the possibility of poor S-100 bus connections confusing the symptoms because of the solder-coated pins on the prototype boards. I wanted to eliminate that possibility by using the new production boards which has gold-plated pins. With these new boards, we will need to look further into Charles' partition size problem and the one I'm reporting here.<P>&nbsp;<P>

<B>Closing</B><P>

This is an exciting, one-time project, especially since our MFM hard drives have become increasingly difficult to find, and repair is virtually impossible. This board promises to be fantastic! Don't miss out. Contact me as soon as possible to reserve your board.<P>
</FONT></TD></TR>

</table>
</td></tr>


<tr><td valign="middle" align="center">
<img src="../images/bar.jpg" hspace="0" vspace="0" alt="--Divider--">
</td></tr>

<tr><td valign="middle" align="center">
<A HREF="mailto:z100lifeline@earthlink.net"> <img src="../images/email.jpg" HSPACE="0" VSPACE="0" BORDER="0"></A><P><A HREF="mailto:z100lifeline@earthlink.net"><FONT FACE="Verdana, Arial" SIZE="4">z100lifeline@earthlink.net</FONT></A>
</td></tr>

<tr><td valign="middle" align="center">
<P>
<table>
<tr><td align="center"><FONT FACE="Verdana, Arial" SIZE="3">
<A HREF="../index.html">
<img src="../images/bullet.jpg" BORDER="0"></A>
<A HREF="../index.html"> HOME Page</A>&nbsp;&nbsp;&nbsp;
</FONT></td>

<td align="center"><FONT FACE="Verdana, Arial" SIZE="3">
<A HREF="../lifeline.html">
<img src="../images/bullet.jpg" BORDER="0"></A>
<A HREF="../lifeline.html"> LifeLine Page</A>&nbsp;&nbsp;&nbsp;
</FONT></td>

<td align="center"><FONT FACE="Verdana, Arial" SIZE="3">
<A HREF="../z100.html">
<img src="../images/bullet.jpg" BORDER="0"></A>
<A HREF="../z100.html"> Z-100 Page</A>&nbsp;&nbsp;&nbsp;
</FONT></td>

<td align="center"><FONT FACE="Verdana, Arial" SIZE="3">
<A HREF="../repair.html">
<img src="../images/bullet.jpg" BORDER="0"></A>
<A HREF="../repair.html"> Repair Page</A>
</FONT></td>

</td></tr>
</table>
</td></tr>

<tr><td align=center><center>
<table>
<TR><TD VALIGN="top" ALIGN="center" WIDTH="370">
<FONT SIZE="-2">
Copyright &copy; 2009, Steven W. Vagts<BR>
Revised -- December 13, 2009
</FONT></TD>

</TR>
</TABLE>
</center>
</td></tr>
</table>    
</BODY></HTML>
